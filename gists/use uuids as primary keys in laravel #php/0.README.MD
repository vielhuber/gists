## laravel >=9

- on laravel 9 you can use the built in trait
- however if you want to have more control you also can use the custom trait below

```php
/* ... */
use Illuminate\Database\Eloquent\Concerns\HasUuids;

class Test extends Model
{
    use HasUuids;
  	/* ... */
}
```

## laravel <=8


- create trait `app/Traits/hasUuid.php`

```php
<?php
namespace App\Traits;
use Illuminate\Support\Str;

trait hasUuid
{
    protected static function boot()
    {
        parent::boot();
        static::creating(function ($model) {
            if (empty($model->{$model->getKeyName()})) {
                $model->{$model->getKeyName()} = Str::orderedUuid()->toString();
            }
        });
    }

    public function getIncrementing()
    {
        return false;
    }

    public function getKeyType()
    {
        return 'string';
    }
}
```

- extend all models

```php
/* ... */
use App\Traits\hasUuid;

class Test extends Model
{
    use hasUuid;
  	/* ... */
}
```

## migrate all existing columns

### postgresql

#### links

- https://blog.hagander.net/automatically-dropping-and-creating-constraints-131/
- https://dataedo.com/kb/query/postgresql/list-all-primary-keys-and-their-columns
- https://stackoverflow.com/a/49429112/2068362

#### raw queries

- see `1.raw-queries.sql`

#### as a migration

```php
<?php
use Illuminate\Support\Facades\DB;
use Illuminate\Database\Migrations\Migration;
class MigrateUuid extends Migration
{
    public function up()
    {
        $query = <<<'EOD'
            SELECT * FROM (
            /* ... */
        EOD;

        $queries = DB::select(DB::raw($query));
        $count = count($queries);
        $count_cur = 0;
        foreach ($queries as $queries__value) {
            DB::statement(current((array) $queries__value));
            echo round((++$count_cur * 100) / $count) . '%' . PHP_EOL;
        }
    }

    public function down()
    {
    }
}
```

#### clear sessions

```sh
rm -f storage/framework/sessions/*
```